sqlite3: CVE-2015-3416

the patch comes from:
https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-3416
http://www.sqlite.org/src/info/c494171f77dc2e5e04cb6d865e688448f04e5920

Guard against excessive width and precision in floating-point
conversions in the printf routines.

Signed-off-by: Li Wang <li.wang@windriver.com>
---
 sqlite3.c |    6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/sqlite3.c b/sqlite3.c
index 590ce3b..3735e97 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -20976,7 +20976,7 @@ SQLITE_PRIVATE void sqlite3VXPrintf(
           else                         prefix = 0;
         }
         if( xtype==etGENERIC && precision>0 ) precision--;
-        for(idx=precision, rounder=0.5; idx>0; idx--, rounder*=0.1){}
+        for(idx=precision&0xfff, rounder=0.5; idx>0; idx--, rounder*=0.1){}
         if( xtype==etFLOAT ) realvalue += rounder;
         /* Normalize realvalue to within 10.0 > realvalue >= 1.0 */
         exp = 0;
@@ -21031,8 +21031,8 @@ SQLITE_PRIVATE void sqlite3VXPrintf(
         }else{
           e2 = exp;
         }
-        if( MAX(e2,0)+precision+width > etBUFSIZE - 15 ){
-          bufpt = zExtra = sqlite3Malloc( MAX(e2,0)+precision+width+15 );
+        if( MAX(e2,0)+(i64)precision+(i64)width > etBUFSIZE - 15 ){
+          bufpt = zExtra = sqlite3Malloc( MAX(e2,0)+(i64)precision+(i64)width+15 );
           if( bufpt==0 ){
             setStrAccumError(pAccum, STRACCUM_NOMEM);
             return;
-- 
1.7.9.5

