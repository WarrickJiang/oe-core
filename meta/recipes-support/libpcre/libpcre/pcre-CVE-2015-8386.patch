r1560 | ph10 | 2015-05-20 00:02:06

Fix buffer overflow for lookbehind within mutually recursive subroutines.

Upstream-Status: Backport

Signed-off-by: Yue Tao <yue.tao@windriver.com>

Index: pcre_compile.c
===================================================================
--- a/pcre_compile.c	(revision 1559)
+++ b/pcre_compile.c	(revision 1560)
@@ -1799,7 +1799,7 @@
     case OP_ASSERTBACK:
     case OP_ASSERTBACK_NOT:
     do cc += GET(cc, 1); while (*cc == OP_ALT);
-    cc += PRIV(OP_lengths)[*cc];
+    cc += 1 + LINK_SIZE;
     break;
 
     /* Skip over things that don't match chars */
Index: testdata/testinput2
===================================================================
--- a/testdata/testinput2	(revision 1559)
+++ b/testdata/testinput2	(revision 1560)
@@ -4168,4 +4168,7 @@
 
 "(?J)(?'d'(?'d'\g{d}))"
 
+".*?\h.+.\.+\R*?\xd(?i)(?=!(?=b`b`b`\`b\xa9b!)`\a`bbbbbbbbbbbbb`bbbbbbbbbbbb*R\x85bbbbbbb\C?{((?2)(?))((
+\H){8(?<=(?1){29}\xa8bbbb\x16\xd\xc6^($(?<! )(\xa9H4){4}h}1)B))\x15')"
+
 /-- End of testinput2 --/
Index: testdata/testoutput2
===================================================================
--- a/testdata/testoutput2	(revision 1559)
+++ b/testdata/testoutput2	(revision 1560)
@@ -14456,4 +14456,7 @@
 
 "(?J)(?'d'(?'d'\g{d}))"
 
+".*?\h.+.\.+\R*?\xd(?i)(?=!(?=b`b`b`\`b\xa9b!)`\a`bbbbbbbbbbbbb`bbbbbbbbbbbb*R\x85bbbbbbb\C?{((?2)(?))((
+\H){8(?<=(?1){29}\xa8bbbb\x16\xd\xc6^($(?<! )(\xa9H4){4}h}1)B))\x15')"
+
 /-- End of testinput2 --/
