From 690e895a5c66433803d5a36cafce83fc1775b022 Mon Sep 17 00:00:00 2001
From: Mark Andrews <marka@isc.org>
Date: Thu, 31 Dec 2015 13:43:21 +1100
Subject: [PATCH 1/2] bind: bug fix for CVE-2015-8704

commit 1b3d21180244529f0099894fe9d29beb3f11efb3 upstream
https://source.isc.org/git/bind9.git

4285. [security] Specific APL data could trigger a INSIST. (CVE-2015-8704) [RT #41396]

Upstream Status: Backport from Redhat
CVE: CVE-2015-8704

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 lib/dns/rdata/in_1/apl_42.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/dns/rdata/in_1/apl_42.c b/lib/dns/rdata/in_1/apl_42.c
index 94133ba..f2d58bc 100644
--- a/lib/dns/rdata/in_1/apl_42.c
+++ b/lib/dns/rdata/in_1/apl_42.c
@@ -116,7 +116,7 @@ totext_in_apl(ARGS_TOTEXT) {
 	isc_uint8_t len;
 	isc_boolean_t neg;
 	unsigned char buf[16];
-	char txt[sizeof(" !64000")];
+	char txt[sizeof(" !64000:")];
 	const char *sep = "";
 	int n;
 
@@ -140,7 +140,7 @@ totext_in_apl(ARGS_TOTEXT) {
 		isc_region_consume(&sr, 1);
 		INSIST(len <= sr.length);
 		n = snprintf(txt, sizeof(txt), "%s%s%u:", sep,
-			     neg ? "!": "", afi);
+			     neg ? "!" : "", afi);
 		INSIST(n < (int)sizeof(txt));
 		RETERR(str_totext(txt, target));
 		switch (afi) {
-- 
1.9.1

