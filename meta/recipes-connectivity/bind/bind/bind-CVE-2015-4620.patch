From f546d99a7356746d0fcdc53ecb20ef7f21990ff0 Mon Sep 17 00:00:00 2001
From: Mark Andrews <marka@isc.org>
Date: Wed, 17 Jun 2015 09:13:03 +1000
Subject: [PATCH 1/1] 4138. [bug] A uninitialized value in validator.c could
 result in a assertion failure. (CVE-2015-4620) [RT #39795]

Signed-off-by: Shan Hai <shan.hai@windriver.com>
---
 CHANGES             | 5 ++++-
 lib/dns/validator.c | 4 +---
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/CHANGES b/CHANGES
index 52cc599..66f3f25 100644
--- a/CHANGES
+++ b/CHANGES
@@ -1,3 +1,6 @@
+4138.	[bug]		A uninitialized value in validator.c could result
+			in a assertion failure. (CVE-2015-4620) [RT #39795]
+
 4053.	[security]	Revoking a managed trust anchor and supplying
 			an untrusted replacement could cause named
 			to crash with an assertion failure.
@@ -7715,7 +7718,7 @@
 			on the responses. [RT #2454]
 
 1208.	[bug]		dns_master_load*() failed to log a error message if
-			an error was detected when parsing the ownername of
+			an error was detected when parsing the owner name of
 			a record.  [RT #2448]
 
 1207.	[bug]		libbind: getaddrinfo() could call freeaddrinfo() with
diff --git a/lib/dns/validator.c b/lib/dns/validator.c
index d7982ca..0c0f7b0 100644
--- a/lib/dns/validator.c
+++ b/lib/dns/validator.c
@@ -1406,7 +1406,6 @@ compute_keytag(dns_rdata_t *rdata, dns_rdata_dnskey_t *key) {
  */
 static isc_boolean_t
 isselfsigned(dns_validator_t *val) {
-	dns_fixedname_t fixed;
 	dns_rdataset_t *rdataset, *sigrdataset;
 	dns_rdata_t rdata = DNS_RDATA_INIT;
 	dns_rdata_t sigrdata = DNS_RDATA_INIT;
@@ -1462,8 +1461,7 @@ isselfsigned(dns_validator_t *val) {
 			result = dns_dnssec_verify3(name, rdataset, dstkey,
 						    ISC_TRUE,
 						    val->view->maxbits,
-						    mctx, &sigrdata,
-						    dns_fixedname_name(&fixed));
+						    mctx, &sigrdata, NULL);
 			dst_key_free(&dstkey);
 			if (result != ISC_R_SUCCESS)
 				continue;
-- 
1.8.5.2.233.g932f7e4

