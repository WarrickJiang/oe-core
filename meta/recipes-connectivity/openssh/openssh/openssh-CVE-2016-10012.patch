From fe7e37ee96dd67aab1925f590c153ffd216cdf40 Mon Sep 17 00:00:00 2001
From: Zhang Xiao <xiao.zhang@windriver.com>
Date: Wed, 28 Dec 2016 10:41:21 +0800
Subject: [PATCH 3/3] openssh: CVE-2016-10012

Commit 0082fba4efdd492f765ed4c53f0d0fbd3bdbdf7f upstream
git://anongit.mindrot.org/openssh.git

OpenSSH is prone to a security-bypass vulnerability.

An attacker may exploit this issue to bypass certain security
restrictions and perform unauthorized actions. This may lead
to further attacks.

Versions prior to OpenSSH 7.4 are vulnerable.

Upstream-Status: Backport
CVE: CVE-2016-10012

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 sshd.c | 7 -------
 1 file changed, 7 deletions(-)

diff --git a/sshd.c b/sshd.c
index 7e6e3c7..18696e3 100644
--- a/sshd.c
+++ b/sshd.c
@@ -115,7 +115,6 @@
 #include "dispatch.h"
 #include "channels.h"
 #include "session.h"
-#include "monitor_mm.h"
 #include "monitor.h"
 #ifdef GSSAPI
 #include "ssh-gss.h"
@@ -691,9 +690,6 @@ privsep_preauth(Authctxt *authctxt)
 			ssh_sandbox_parent_preauth(box, pid);
 		monitor_child_preauth(authctxt, pmonitor);
 
-		/* Sync memory */
-		monitor_sync(pmonitor);
-
 		/* Wait for the child's exit status */
 		while (waitpid(pid, &status, 0) < 0) {
 			if (errno == EINTR)
@@ -2576,9 +2572,6 @@ do_ssh2_kex(void)
 	if (options.compression == COMP_NONE) {
 		myproposal[PROPOSAL_COMP_ALGS_CTOS] =
 		myproposal[PROPOSAL_COMP_ALGS_STOC] = "none";
-	} else if (options.compression == COMP_DELAYED) {
-		myproposal[PROPOSAL_COMP_ALGS_CTOS] =
-		myproposal[PROPOSAL_COMP_ALGS_STOC] = "none,zlib@openssh.com";
 	}
 
 	if (options.rekey_limit || options.rekey_interval)
-- 
1.9.1

