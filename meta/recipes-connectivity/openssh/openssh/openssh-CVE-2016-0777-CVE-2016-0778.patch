From c919b803eeb72c9f384c78c87dffcef38bf67f19 Mon Sep 17 00:00:00 2001
From: Damien Miller <djm@mindrot.org>
Date: Fri, 15 Jan 2016 01:30:36 +1100
Subject: [PATCH] openssh: forcibly disable roaming support in the client

commit e6c85f8889c5c9eb04796fdb76d2807636b9eef5 upstream
git://anongit.mindrot.org/openssh.git

Upstream-Status: Backport
CVE: CVE-2016-0777 CVE-2016-0778

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 readconf.c | 5 ++---
 ssh.c      | 3 ---
 2 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/readconf.c b/readconf.c
index 1d03bdf..cd01482 100644
--- a/readconf.c
+++ b/readconf.c
@@ -1660,7 +1660,7 @@ initialize_options(Options * options)
 	options->tun_remote = -1;
 	options->local_command = NULL;
 	options->permit_local_command = -1;
-	options->use_roaming = -1;
+	options->use_roaming = 0;
 	options->visual_host_key = -1;
 	options->ip_qos_interactive = -1;
 	options->ip_qos_bulk = -1;
@@ -1833,8 +1833,7 @@ fill_default_options(Options * options)
 		options->tun_remote = SSH_TUNID_ANY;
 	if (options->permit_local_command == -1)
 		options->permit_local_command = 0;
-	if (options->use_roaming == -1)
-		options->use_roaming = 1;
+	options->use_roaming = 0;
 	if (options->visual_host_key == -1)
 		options->visual_host_key = 0;
 	if (options->ip_qos_interactive == -1)
diff --git a/ssh.c b/ssh.c
index 59c1f93..67c1ebf 100644
--- a/ssh.c
+++ b/ssh.c
@@ -1932,9 +1932,6 @@ ssh_session2(void)
 			fork_postauth();
 	}
 
-	if (options.use_roaming)
-		request_roaming();
-
 	return client_loop(tty_flag, tty_flag ?
 	    options.escape_char : SSH_ESCAPECHAR_NONE, id);
 }
-- 
1.9.1

