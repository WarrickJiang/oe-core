From 0f7e791203b39ac444468b6c230c0298cce28602 Mon Sep 17 00:00:00 2001
From: "Dr. Stephen Henson" <steve@openssl.org>
Date: Fri, 5 Jun 2015 12:11:25 +0100
Subject: [PATCH 4/7] openssl: CVE-2015-1792

Commit dd90a91d8771fd1ad5083fd46a2b3da16a587757 upstream
https://github.com/openssl/openssl.git

Fix infinite loop in CMS

Fix loop in do_free_upto if cmsbio is NULL: this will happen when attempting
to verify and a digest is not recognised. Reported by Johannes Bauer.

CVE-2015-1792

Reviewed-by: Matt Caswell <matt@openssl.org>
Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 crypto/cms/cms_smime.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/crypto/cms/cms_smime.c b/crypto/cms/cms_smime.c
index 1af9f3a..1d7725c 100644
--- a/crypto/cms/cms_smime.c
+++ b/crypto/cms/cms_smime.c
@@ -141,7 +141,7 @@ static void do_free_upto(BIO *f, BIO *upto)
 			BIO_free(f);
 			f = tbio;
 			}
-		while (f != upto);
+		while (f && f != upto);
 		}
 	else
 		BIO_free_all(f);
-- 
1.8.5.2.233.g932f7e4

