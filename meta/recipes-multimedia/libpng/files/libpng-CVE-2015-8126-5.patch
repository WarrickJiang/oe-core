libpng: CVE-2015-8126 5

the patch comes from:
https://bugzilla.redhat.com/show_bug.cgi?id=1281756
https://github.com/glennrp/libpng/commit/9f2ad4928e47036cf1ac9b8fe45a491f15be2324

[libpng16] Fixed new bug with CRC error after reading an over-length ...

Signed-off-by: Li Wang <li.wang@windriver.com>
---
 pngrutil.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pngrutil.c b/pngrutil.c
index aa7844e..0337765 100644
--- a/pngrutil.c
+++ b/pngrutil.c
@@ -977,7 +977,7 @@ png_handle_PLTE(png_structrp png_ptr, png_inforp info_ptr, png_uint_32 length)
    if (png_ptr->color_type == PNG_COLOR_TYPE_PALETTE)
 #endif
    {
-      png_crc_finish(png_ptr, 0);
+      png_crc_finish(png_ptr, (int) length - num * 3);
    }
 
 #ifndef PNG_READ_OPT_PLTE_SUPPORTED
-- 
1.7.9.5

